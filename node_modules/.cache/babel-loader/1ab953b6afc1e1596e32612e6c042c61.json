{"ast":null,"code":"import _defineProperty from\"C:/Users/Lenovo/nutrition-assistant-webapp/frontend/node_modules/@babel/runtime/helpers/esm/defineProperty.js\";import _objectSpread from\"C:/Users/Lenovo/nutrition-assistant-webapp/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _toConsumableArray from\"C:/Users/Lenovo/nutrition-assistant-webapp/frontend/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _regeneratorRuntime from\"C:/Users/Lenovo/nutrition-assistant-webapp/frontend/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"C:/Users/Lenovo/nutrition-assistant-webapp/frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"C:/Users/Lenovo/nutrition-assistant-webapp/frontend/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React,{Fragment,useEffect,useState}from'react';import{useLocation,useNavigate}from'react-router-dom';import KeyboardBackspaceIcon from'@mui/icons-material/KeyboardBackspace';import CameraswitchIcon from'@mui/icons-material/Cameraswitch';import'../../styles/scan.module.css';import ArrowForwardIos from'@mui/icons-material/ArrowForwardIos';import CheckCircleOutlineIcon from'@mui/icons-material/CheckCircleOutline';import Nutrients from'./Nutrients';import{Box,Container,Divider}from'@mui/material';import{API}from'../../services/apis';import{useSnackbar}from'notistack';import{FullPageLoading}from'../../Components/LoadingSpinner';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var UNITS=['gm','ounce','ml','pieces','slices','cup','tbsp'];var ScannedImg=function ScannedImg(){var _useSnackbar=useSnackbar(),enqueueSnackbar=_useSnackbar.enqueueSnackbar;var _useLocation=useLocation(),state=_useLocation.state;var navigate=useNavigate();var _useState=useState([]),_useState2=_slicedToArray(_useState,2),selectedItems=_useState2[0],setselectedItems=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),screen=_useState4[0],setscreen=_useState4[1];var _useState5=useState(''),_useState6=_slicedToArray(_useState5,2),image=_useState6[0],setimage=_useState6[1];var _useState7=useState(''),_useState8=_slicedToArray(_useState7,2),imageBlob=_useState8[0],setimageBlob=_useState8[1];var _useState9=useState([]),_useState10=_slicedToArray(_useState9,2),foodItems=_useState10[0],setfoodItems=_useState10[1];var _useState11=useState(false),_useState12=_slicedToArray(_useState11,2),isLoading=_useState12[0],setisLoading=_useState12[1];var _useState13=useState([]),_useState14=_slicedToArray(_useState13,2),nutrientsList=_useState14[0],setnutrientsList=_useState14[1];var _useState15=useState(''),_useState16=_slicedToArray(_useState15,2),consumed_food_id=_useState16[0],setconsumed_food_id=_useState16[1];var handleSelectImage=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(foodImage){var res,_err$response,_err$response$data;return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return API.captureFood({foodImage:foodImage});case 3:res=_context.sent;setimage(res.image_url);setimageBlob(URL.createObjectURL(foodImage));setfoodItems(res.foodItems);_context.next=12;break;case 9:_context.prev=9;_context.t0=_context[\"catch\"](0);if(_context.t0!==null&&_context.t0!==void 0&&(_err$response=_context.t0.response)!==null&&_err$response!==void 0&&(_err$response$data=_err$response.data)!==null&&_err$response$data!==void 0&&_err$response$data.msg)enqueueSnackbar(_context.t0.response.data.msg,{variant:'error'});else enqueueSnackbar('Something went wrong. Try again',{variant:'error'});case 12:case\"end\":return _context.stop();}}},_callee,null,[[0,9]]);}));return function handleSelectImage(_x){return _ref.apply(this,arguments);};}();var handleSelectItem=function handleSelectItem(foodItem){if(selectedItems.find(function(item){return item.id===foodItem.id;})){setselectedItems(selectedItems.filter(function(item){return item.id!==foodItem.id;}));}else{if(selectedItems.length===3){enqueueSnackbar('Select 3 items only',{variant:'error'});return;}setselectedItems([].concat(_toConsumableArray(selectedItems),[_objectSpread(_objectSpread({},foodItem),{},{qty:50,unit:'gm'})]));}};var handleModifyItem=function handleModifyItem(_ref2){var value=_ref2.value,id=_ref2.id,field=_ref2.field;setselectedItems(function(prevState){var items=_toConsumableArray(prevState);var idx=items.findIndex(function(item){return item.id===id;});items[idx]=_objectSpread(_objectSpread({},items[idx]),{},_defineProperty({},field,value));return items;});};var handleNext=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(){var res,_err$response2,_err$response2$data;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:if(!(selectedItems.length===0)){_context2.next=3;break;}enqueueSnackbar('Please select atleast 1 item',{variant:'error'});return _context2.abrupt(\"return\");case 3:setisLoading(true);_context2.prev=4;_context2.next=7;return API.foodNutritionDetails({image_url:image,food_item:selectedItems.reduce(function(prev,curr,idx,arr){return prev+\"\".concat(curr.qty,\" \").concat(curr.unit,\" \")+curr.name+(idx===arr.length-1?'':', ');},'').substring(0,90)});case 7:res=_context2.sent;setscreen(true);setnutrientsList(res.nutrients);setconsumed_food_id(res.consumed_food_id);_context2.next=16;break;case 13:_context2.prev=13;_context2.t0=_context2[\"catch\"](4);if(_context2.t0!==null&&_context2.t0!==void 0&&(_err$response2=_context2.t0.response)!==null&&_err$response2!==void 0&&(_err$response2$data=_err$response2.data)!==null&&_err$response2$data!==void 0&&_err$response2$data.msg)enqueueSnackbar(_context2.t0.response.data.msg,{variant:'error'});else enqueueSnackbar('Something went wrong. Try again',{variant:'error'});case 16:setisLoading(false);case 17:case\"end\":return _context2.stop();}}},_callee2,null,[[4,13]]);}));return function handleNext(){return _ref3.apply(this,arguments);};}();useEffect(function(){if(!state.image_url||!state.foodItems||!state.imageBlob)navigate('/');else{setimage(state.image_url);setfoodItems(state.foodItems);setimageBlob(state.imageBlob);}},[]);return/*#__PURE__*/_jsxs(\"div\",{maxWidth:\"lg\",style:{backgroundColor:'var(--backgroundColor)'},children:[/*#__PURE__*/_jsx(FullPageLoading,{isLoading:isLoading}),/*#__PURE__*/_jsx(Box,{sx:{pb:'2rem'},children:!screen?/*#__PURE__*/_jsx(Container,{maxWidth:\"md\",children:/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"div\",{style:{paddingTop:'1rem',background:'var(--backgroundColor)',position:'fixed',width:'100%',padding:'0.8rem 0.5rem 0.5rem 0.5rem',top:0,left:0},children:/*#__PURE__*/_jsx(Container,{maxWidth:\"md\",children:/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',justifyContent:'space-between'},children:[/*#__PURE__*/_jsxs(\"button\",{style:{display:'block',background:'var(--backgroundColor)',border:'0'},onClick:function onClick(e){navigate('/dashboard');},children:[' ',/*#__PURE__*/_jsx(KeyboardBackspaceIcon,{sx:{fontSize:'35px'}})]}),/*#__PURE__*/_jsxs(\"button\",{style:{display:'flex',border:'0',padding:'8px',background:'var(--themecolor)',color:'#fff',margin:'3px 8px 0 0',borderRadius:'4px',alignItems:'center'},onClick:handleNext,children:[' ',/*#__PURE__*/_jsx(\"span\",{style:{fontSize:'16px'},children:\"Next\"}),' ',/*#__PURE__*/_jsx(ArrowForwardIos,{sx:{fontSize:'16px'}})]})]})})}),/*#__PURE__*/_jsx(\"div\",{style:{display:'flex',justifyContent:'center',paddingTop:'4.3rem'},children:/*#__PURE__*/_jsx(\"img\",{style:{objectFit:'cover',width:'94%',height:'35vh',borderRadius:'8px'},src:imageBlob,alt:\"\"})}),/*#__PURE__*/_jsxs(\"div\",{style:{display:'inline'},children:[/*#__PURE__*/_jsx(\"input\",{type:\"file\",accept:\"image/*\",capture:\"environment\",id:\"img\",style:{display:'none'},onChange:function onChange(e){if(e.target.files)handleSelectImage(e.target.files[0]);}}),/*#__PURE__*/_jsx(\"div\",{style:{display:'flex',justifyContent:'flex-end',marginRight:'6px'},children:/*#__PURE__*/_jsxs(\"label\",{htmlFor:\"img\",style:{padding:'8px',background:'var(--themecolor)',color:'#fff',width:'6.8rem',margin:'10px 8px 0 0',borderRadius:'5px',display:'flex',alignItems:'center'},children:[/*#__PURE__*/_jsx(CameraswitchIcon,{}),' ',/*#__PURE__*/_jsx(\"span\",{style:{marginLeft:'7px'},children:\"Retake\"})]})})]}),/*#__PURE__*/_jsx(\"h3\",{align:\"center\",style:{marginTop:'8px'},children:\"Select the ingredients\"}),/*#__PURE__*/_jsx(\"div\",{style:{display:'flex',justifyContent:'center',margin:'20px auto 0 auto',width:'97%',height:'39vh',overflow:'scroll',backgroundColor:'#fff',borderRadius:'8px',background:'var(--lightOrange)',boxShadow:'0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19)'},children:/*#__PURE__*/_jsx(\"table\",{style:{padding:'0.1rem',width:'100%'},children:/*#__PURE__*/_jsx(\"tbody\",{children:foodItems.map(function(item,idx,arr){var selectedItem=selectedItems.find(function(x){return x.id===item.id;});return/*#__PURE__*/_jsxs(Fragment,{children:[/*#__PURE__*/_jsx(\"tr\",{children:/*#__PURE__*/_jsxs(\"td\",{style:{position:'relative'},onClick:function onClick(){handleSelectItem(item);},children:[/*#__PURE__*/_jsx(\"span\",{style:{display:'inline-block',marginLeft:'16px'},children:item.name}),Boolean(selectedItem)?/*#__PURE__*/_jsxs(\"span\",{children:[/*#__PURE__*/_jsx(\"span\",{style:{position:'absolute',left:0,marginTop:'4px'},children:/*#__PURE__*/_jsx(CheckCircleOutlineIcon,{sx:{display:'inline',color:'var(--themecolor)'}})}),/*#__PURE__*/_jsxs(\"span\",{style:{position:'absolute',right:0},children:[/*#__PURE__*/_jsx(\"input\",{style:{padding:'5px',width:'4rem',background:'var(--backgroundColor)',borderRadius:'3px',border:'1px solid var(--backgroundColor)',marginRight:'0.4rem'},onClick:function onClick(event){event.stopPropagation();},onChange:function onChange(e){return handleModifyItem({value:e.target.value,id:item.id,field:'qty'});},type:\"number\",value:String(selectedItem.qty)}),/*#__PURE__*/_jsx(\"select\",{style:{backgroundColor:'var(--lightOrange)',border:'1px solid var(--lightOrange)'},onClick:function onClick(e){e.stopPropagation();},value:selectedItem.unit,onChange:function onChange(e){return handleModifyItem({value:e.target.value,id:item.id,field:'unit'});},children:UNITS.map(function(unit){return/*#__PURE__*/_jsx(\"option\",{value:unit,style:{backgroundColor:'var(--backgroundColor)'},children:unit},unit);})})]})]}):'']})}),idx!==arr.length-1&&/*#__PURE__*/_jsx(Divider,{})]},item.id);})})})})]})}):/*#__PURE__*/_jsx(Nutrients,{setisLoading:setisLoading,consumedFoodId:consumed_food_id,nutrientsList:nutrientsList,setscreen:setscreen,image_url:image,imageBlob:imageBlob})})]});};export default ScannedImg;","map":null,"metadata":{},"sourceType":"module"}